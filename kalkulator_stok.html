<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Stok Pintar (Newsvendor Model)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .input-field {
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .accordion-content.open {
            max-height: 500px;
        }
        
        .result-card {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }
        
        .emoji-bounce {
            display: inline-block;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-primary-50 via-white to-emerald-50 min-h-screen">
    <div class="max-w-lg mx-auto px-4 py-6 pb-24">
        
        <!-- Header Section -->
        <header class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary-500 to-emerald-600 rounded-2xl shadow-lg mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">üõí Kalkulator Belanja Pintar</h1>
            <p class="text-gray-600 text-sm leading-relaxed">
                Bantu tentukan jumlah belanja optimal agar <span class="font-semibold text-primary-600">untung maksimal</span> & <span class="font-semibold text-amber-600">meminimalkan sisa</span>. Model ini dikembangkan berdasarkan prinsip probabilitas The Newsvendor Problem yang berakar dari pemikiran F.Y. Edgeworth (1888) dan disempurnakan untuk manajemen stok modern oleh T.M. Whitin (1955).
            </p>
        </header>

        <!-- Educational Accordion -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-6 overflow-hidden">
            <button 
                id="accordionBtn" 
                class="w-full px-5 py-4 flex items-center justify-between text-left hover:bg-gray-50 transition-colors"
                onclick="toggleAccordion()"
            >
                <div class="flex items-center gap-3">
                    <span class="text-xl">üí°</span>
                    <span class="font-semibold text-gray-700">Gimana cara kerjanya?</span>
                </div>
                <svg id="accordionIcon" class="w-5 h-5 text-gray-400 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="accordionContent" class="accordion-content">
                <div class="px-5 pb-5 pt-1">
                    <div class="bg-gradient-to-r from-primary-50 to-emerald-50 rounded-xl p-4 border border-primary-100">
                        <p class="text-gray-600 text-sm leading-relaxed">
                            <span class="font-semibold text-gray-800">Aplikasi ini menghitung keseimbangan</span> antara:
                        </p>
                        <ul class="mt-3 space-y-2">
                            <li class="flex items-start gap-2 text-sm">
                                <span class="text-red-500 mt-0.5">üìâ</span>
                                <span><strong class="text-red-600">Risiko barang sisa</strong> (rugi modal)</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm">
                                <span class="text-amber-500 mt-0.5">üìà</span>
                                <span><strong class="text-amber-600">Risiko barang kurang</strong> (rugi kesempatan untung)</span>
                            </li>
                        </ul>
                        <div class="mt-4 pt-3 border-t border-primary-200">
                            <p class="text-xs text-gray-500 italic">
                                üè¢ Rumus ini dipakai perusahaan besar, tapi sudah disederhanakan khusus untuk Anda!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Form -->
        <form id="calculatorForm" class="space-y-4">
            
            <!-- Section: Tentang Barang -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-lg">üì¶</span>
                    <h2 class="font-bold text-gray-800">Tentang Barang</h2>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Nama Barang
                    </label>
                    <input 
                        type="text" 
                        id="namaBarang" 
                        placeholder="Contoh: Nasi Bungkus, Ayam Goreng..."
                        class="input-field w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-primary-500 focus:ring-0 focus:outline-none text-base"
                        required
                    >
                </div>
            </div>

            <!-- Section: Tentang Uang -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-lg">üí∞</span>
                    <h2 class="font-bold text-gray-800">Tentang Uang</h2>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Modal per biji/porsi
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Biaya beli atau bikin satu unit</p>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                            <input 
                                type="number" 
                                id="modal" 
                                placeholder="5.000"
                                min="0"
                                class="input-field w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-primary-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Harga Jual per biji/porsi
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Dijual ke pembeli berapa?</p>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                            <input 
                                type="number" 
                                id="hargaJual" 
                                placeholder="10.000"
                                min="0"
                                class="input-field w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-primary-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Jika tidak laku, sisa barang laku dijual berapa?
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Isi <strong>0</strong> jika basi/dibuang. Isi nominal jika bisa dijual murah atau jadi pakan ternak.</p>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                            <input 
                                type="number" 
                                id="salvage" 
                                placeholder="0"
                                min="0"
                                value="0"
                                class="input-field w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-primary-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section: Kebiasaan Pembeli (Magic Section) -->
            <div class="bg-gradient-to-br from-primary-50 to-emerald-50 rounded-2xl shadow-sm border border-primary-200 p-5">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-lg emoji-bounce">‚ú®</span>
                    <h2 class="font-bold text-gray-800">Tentang Kebiasaan Pembeli</h2>
                </div>
                <p class="text-xs text-gray-500 mb-4">Bagian paling penting! Ingat-ingat pola penjualan Anda.</p>
                
                <div class="space-y-4">
                    <div class="bg-white rounded-xl p-4 border border-primary-100">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            üõçÔ∏è Biasanya sehari rata-rata laku berapa?
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Angka yang paling sering terjadi</p>
                        <div class="relative">
                            <input 
                                type="number" 
                                id="rataRata" 
                                placeholder="30"
                                min="0"
                                class="input-field w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-primary-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm">unit</span>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 border border-blue-100">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            üòî Kalau lagi <span class="text-blue-600 font-bold">SEPI BANGET</span>, laku berapa?
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Hari paling sepi yang pernah Anda alami</p>
                        <div class="relative">
                            <input 
                                type="number" 
                                id="minPenjualan" 
                                placeholder="15"
                                min="0"
                                class="input-field w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-blue-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm">unit</span>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 border border-amber-100">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            üéâ Kalau lagi <span class="text-amber-600 font-bold">RAMAI BANGET</span>, laku berapa?
                        </label>
                        <p class="text-xs text-gray-500 mb-2">Hari paling ramai yang pernah Anda alami</p>
                        <div class="relative">
                            <input 
                                type="number" 
                                id="maxPenjualan" 
                                placeholder="50"
                                min="0"
                                class="input-field w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:border-amber-500 focus:ring-0 focus:outline-none text-base"
                                required
                            >
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm">unit</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <button 
                type="submit" 
                class="w-full bg-gradient-to-r from-primary-600 to-emerald-600 hover:from-primary-700 hover:to-emerald-700 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-200 text-lg flex items-center justify-center gap-2"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                Hitung Jumlah Belanja Terbaik
            </button>
        </form>

        <!-- Result Card (Hidden by default) -->
        <div id="resultCard" class="hidden mt-6">
            <div class="result-card bg-white rounded-2xl shadow-xl border-2 border-primary-200 overflow-hidden">
                <!-- Header Result -->
                <div class="bg-gradient-to-r from-primary-600 to-emerald-600 p-5 text-white">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="font-semibold">Hasil Perhitungan</span>
                    </div>
                    <p class="text-primary-100 text-sm">Rekomendasi berdasarkan data Anda</p>
                </div>
                
                <!-- Main Result -->
                <div class="p-5">
                    <div class="bg-gradient-to-br from-primary-50 to-emerald-50 rounded-xl p-5 border border-primary-100 text-center mb-4">
                        <p class="text-gray-600 mb-2">Untuk besok, sebaiknya Anda belanja/masak:</p>
                        <div class="flex items-center justify-center gap-3">
                            <span id="resultNumber" class="text-5xl font-extrabold text-primary-600">0</span>
                            <span id="resultUnit" class="text-lg text-gray-700 font-medium">Unit</span>
                        </div>
                        <p id="resultItemName" class="text-gray-500 mt-2 font-medium"></p>
                    </div>
                    
                    <!-- Explanation -->
                    <div class="bg-amber-50 rounded-xl p-4 border border-amber-200 mb-4">
                        <div class="flex items-start gap-3">
                            <span class="text-xl">ü§î</span>
                            <div>
                                <p class="font-semibold text-gray-800 mb-1">Kenapa segitu?</p>
                                <p id="explanationText" class="text-sm text-gray-600 leading-relaxed">
                                    <!-- Dynamic explanation -->
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analysis Detail -->
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3">üìä Detail Analisis</p>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-white rounded-lg p-3 border border-gray-100">
                                <p class="text-xs text-gray-500">Peluang Terpenuhi</p>
                                <p id="serviceLevel" class="text-lg font-bold text-primary-600">0%</p>
                            </div>
                            <div class="bg-white rounded-lg p-3 border border-gray-100">
                                <p class="text-xs text-gray-500">Margin Untung</p>
                                <p id="profitMargin" class="text-lg font-bold text-emerald-600">Rp 0</p>
                            </div>
                            <div class="bg-white rounded-lg p-3 border border-gray-100">
                                <p class="text-xs text-gray-500">Risiko Sisa per Unit</p>
                                <p id="wasteRisk" class="text-lg font-bold text-red-500">Rp 0</p>
                            </div>
                            <div class="bg-white rounded-lg p-3 border border-gray-100">
                                <p class="text-xs text-gray-500">Status</p>
                                <p id="statusText" class="text-lg font-bold text-blue-600">Aman</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tips -->
                    <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                        <div class="flex items-start gap-2">
                            <span class="text-lg">üí°</span>
                            <div>
                                <p class="font-semibold text-blue-800 text-sm">Tips:</p>
                                <p id="tipsText" class="text-xs text-blue-700 mt-1">
                                    <!-- Dynamic tips -->
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reset Button -->
            <button 
                type="button" 
                onclick="resetForm()"
                class="w-full mt-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Hitung Ulang
            </button>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-8 pt-6 border-t border-gray-200">
            <p class="text-xs text-gray-400">
                Dibuat untuk UMKM Indonesia
            </p>
            <p class="text-xs text-gray-400 mt-1">
                &copy; mywhatitu creativity
            </p>
        </footer>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform scale-95 opacity-0 transition-all duration-200" id="alertContent">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Oops! Ada yang salah</h3>
                <p id="alertMessage" class="text-gray-600 text-sm mb-4"></p>
                <button 
                    onclick="closeAlert()"
                    class="w-full bg-gray-800 hover:bg-gray-900 text-white font-semibold py-3 px-6 rounded-xl transition-colors"
                >
                    Mengerti
                </button>
            </div>
        </div>
    </div>

    <script>
        // Accordion Toggle
        function toggleAccordion() {
            const content = document.getElementById('accordionContent');
            const icon = document.getElementById('accordionIcon');
            content.classList.toggle('open');
            icon.classList.toggle('rotate-180');
        }

        // Alert Functions
        function showAlert(message) {
            const modal = document.getElementById('alertModal');
            const content = document.getElementById('alertContent');
            const msgEl = document.getElementById('alertMessage');
            
            msgEl.textContent = message;
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeAlert() {
            const modal = document.getElementById('alertModal');
            const content = document.getElementById('alertContent');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        // Acklam's Algorithm for Inverse Normal CDF
        function normsinv(p) {
            if (p <= 0) return -Infinity;
            if (p >= 1) return Infinity;
            
            const a1 = -3.969683028665376e+01;
            const a2 = 2.209460984245205e+02;
            const a3 = -2.759285104469687e+02;
            const a4 = 1.383577518672690e+02;
            const a5 = -3.066479806614716e+01;
            const a6 = 2.506628277459239e+00;

            const b1 = -5.447609879822406e+01;
            const b2 = 1.615858368580409e+02;
            const b3 = -1.556989798598866e+02;
            const b4 = 6.680131188771972e+01;
            const b5 = -1.328068155288572e+01;

            const c1 = -7.784894002430293e-03;
            const c2 = -3.223964580411365e-01;
            const c3 = -2.400758277161838e+00;
            const c4 = -2.549732539343734e+00;
            const c5 = 4.374664141464968e+00;
            const c6 = 2.938163982698783e+00;

            const d1 = 7.784695709041462e-03;
            const d2 = 3.224671290700398e-01;
            const d3 = 2.445134137142996e+00;
            const d4 = 3.754408661907416e+00;

            const p_low = 0.02425;
            const p_high = 1 - p_low;

            let q, r;

            if (p < p_low) {
                q = Math.sqrt(-2 * Math.log(p));
                return (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
                       ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            } else if (p <= p_high) {
                q = p - 0.5;
                r = q * q;
                return (((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q /
                       (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1);
            } else {
                q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
                        ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            }
        }

        // Format number to Indonesian Rupiah
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID').format(number);
        }

        // Main Calculation
        function calculate(data) {
            const { mean, min, max, cost, price, salvage } = data;
            
            // Calculate Standard Deviation using Range Rule of Thumb
            let sigma = (max - min) / 4;
            if (sigma === 0) sigma = 0.1; // Avoid division by zero
            
            // Calculate Costs
            const Cu = price - cost; // Underage cost (profit margin)
            const Co = cost - salvage; // Overage cost (risk of waste)
            
            // Calculate Critical Ratio
            const CR = Cu / (Cu + Co);
            
            // Get Z-score from Critical Ratio
            const Z = normsinv(CR);
            
            // Calculate Optimal Q*
            let optimalQ = mean + (Z * sigma);
            
            // Round to nearest integer
            optimalQ = Math.round(optimalQ);
            
            // Ensure Q is at least 1
            if (optimalQ < 1) optimalQ = 1;
            
            return {
                optimalQ,
                serviceLevel: CR * 100,
                profitMargin: Cu,
                wasteRisk: Co,
                sigma,
                Z,
                CR
            };
        }

        // Form Submission
        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get values
            const namaBarang = document.getElementById('namaBarang').value.trim();
            const modal = parseFloat(document.getElementById('modal').value) || 0;
            const hargaJual = parseFloat(document.getElementById('hargaJual').value) || 0;
            const salvage = parseFloat(document.getElementById('salvage').value) || 0;
            const rataRata = parseFloat(document.getElementById('rataRata').value) || 0;
            const minPenjualan = parseFloat(document.getElementById('minPenjualan').value) || 0;
            const maxPenjualan = parseFloat(document.getElementById('maxPenjualan').value) || 0;
            
            // Validation
            if (!namaBarang) {
                showAlert('Nama barang harus diisi!');
                return;
            }
            
            if (modal <= 0) {
                showAlert('Modal harus lebih dari 0!');
                return;
            }
            
            if (hargaJual <= modal) {
                showAlert('Harga jual harus lebih tinggi dari modal! Kalau tidak, Anda rugi dong...');
                return;
            }
            
            if (salvage > modal) {
                showAlert('Nilai sisa tidak boleh lebih tinggi dari modal!');
                return;
            }
            
            if (rataRata <= 0) {
                showAlert('Rata-rata penjualan harus lebih dari 0!');
                return;
            }
            
            if (minPenjualan < 0) {
                showAlert('Penjualan minimum tidak boleh negatif!');
                return;
            }
            
            if (maxPenjualan <= minPenjualan) {
                showAlert('Penjualan maksimum harus lebih besar dari minimum!');
                return;
            }
            
            if (rataRata < minPenjualan || rataRata > maxPenjualan) {
                showAlert('Rata-rata penjualan harus di antara nilai minimum dan maksimum!');
                return;
            }
            
            // Calculate
            const result = calculate({
                mean: rataRata,
                min: minPenjualan,
                max: maxPenjualan,
                cost: modal,
                price: hargaJual,
                salvage: salvage
            });
            
            // Display results
            displayResults(result, namaBarang);
        });

        // Display Results
        function displayResults(result, itemName) {
            const resultCard = document.getElementById('resultCard');
            
            // Main result
            document.getElementById('resultNumber').textContent = result.optimalQ;
            document.getElementById('resultItemName').textContent = itemName;
            
            // Service level and other metrics
            document.getElementById('serviceLevel').textContent = result.serviceLevel.toFixed(0) + '%';
            document.getElementById('profitMargin').textContent = 'Rp ' + formatRupiah(result.profitMargin);
            document.getElementById('wasteRisk').textContent = 'Rp ' + formatRupiah(result.wasteRisk);
            
            // Status
            let status = '';
            let statusColor = '';
            if (result.serviceLevel >= 70) {
                status = 'Aman ‚úÖ';
                statusColor = 'text-green-600';
            } else if (result.serviceLevel >= 50) {
                status = 'Wajar üëç';
                statusColor = 'text-blue-600';
            } else {
                status = 'Hati-hati ‚ö†Ô∏è';
                statusColor = 'text-amber-600';
            }
            const statusEl = document.getElementById('statusText');
            statusEl.textContent = status;
            statusEl.className = 'text-lg font-bold ' + statusColor;
            
            // Explanation
            let explanation = '';
            const marginRatio = result.profitMargin / result.wasteRisk;
            
            if (marginRatio > 2) {
                explanation = `Karena untung Anda lumayan BESAR (Rp ${formatRupiah(result.profitMargin)} per unit) dibanding risiko rugi sisa (Rp ${formatRupiah(result.wasteRisk)} per unit). Dengan ${result.optimalQ} unit, Anda punya peluang ${result.serviceLevel.toFixed(0)}% dagangan habis tapi pembeli tetap kebagian.`;
            } else if (marginRatio > 1) {
                explanation = `Karena untung Anda cukup baik (Rp ${formatRupiah(result.profitMargin)} per unit) dibanding risiko rugi sisa (Rp ${formatRupiah(result.wasteRisk)} per unit). Jumlah ${result.optimalQ} unit memberikan keseimbangan terbaik antara keuntungan dan risiko.`;
            } else {
                explanation = `Karena margin untung Anda tipis (Rp ${formatRupiah(result.profitMargin)} per unit), sementara risiko rugi cukup besar jika tidak laku (Rp ${formatRupiah(result.wasteRisk)} per unit). Lebih baik stok sedikit dulu (${result.optimalQ} unit) untuk menghindari kerugian.`;
            }
            document.getElementById('explanationText').textContent = explanation;
            
            // Tips
            let tips = '';
            if (result.serviceLevel >= 80) {
                tips = 'Margin Anda bagus! Anda bisa sedikit lebih berani menambah stok jika yakin ada peluang pembeli lebih banyak.';
            } else if (result.serviceLevel >= 60) {
                tips = 'Ini sudah perhitungan yang seimbang. Catat penjualan harian Anda untuk memperbaiki perkiraan di masa depan.';
            } else if (result.serviceLevel >= 40) {
                tips = 'Margin Anda tipis, jadi lebih baik berhati-hati. Coba cari cara untuk menekan biaya modal atau menaikkan harga jual.';
            } else {
                tips = 'Peringatan: Margin sangat tipis! Pertimbangkan untuk menaikkan harga jual atau mencari supplier dengan harga lebih murah.';
            }
            document.getElementById('tipsText').textContent = tips;
            
            // Show result card
            resultCard.classList.remove('hidden');
            
            // Scroll to result
            setTimeout(() => {
                resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Reset Form
        function resetForm() {
            document.getElementById('calculatorForm').reset();
            document.getElementById('resultCard').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close alert on backdrop click
        document.getElementById('alertModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAlert();
            }
        });
    </script>
</body>
</html>